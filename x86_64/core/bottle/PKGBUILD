pkgname=bottle
pkgver=2023.1
pkgrel=1
arch=('x86_64')
depends=(zstd bash glibc libarchive curl gpgme libassuan)
commitid=76450251d000de0832889292a26acad560698ace
replaces=(pacman)
source=(git+https://git.martinvlba.eu/DrunkOS/bottle.git#commit=$commitid)

build() {
	cd $pkgname

	meson \
	--prefix=/usr \
	-D doxygen=enabled \
	-D scriptlet-shell=/bin/bash \
	-D ldconfig=/usr/bin/ldconfig \
	build

	ninja -C build
}

package() {
	cd $pkgname
	
	mkdir -vp $pkgdir
	export DESTDIR=$pkgdir/
	
	ninja -C build install

	# copy our own bottle.conf that has proper server list
	cp -f ../../bottle.conf $pkgdir/etc/bottle.conf
	mkdir -p $pkgdir/etc/bottle.d
	touch $pkgdir/etc/bottle.d/mirrorlist
}
